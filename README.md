# Uncraft: Minecraft Server Monitor
![미리보기](preview.png)
~~메모리 표시에 버그가 있어 보이지만 넘어가자~~  
마인크래프트 서버를 모니터링해보자!  
...라는 컨셉으로 개발된 툴입니다. 서버의 하드웨어 상태(CPU 상태나 메모리 사용량 등), 혹은 마인크래프트 서버 내의 특정 위치에 대한 지도 및 온라인 플레이어 상황 등을 확인할 수 있습니다.  

## 사용하려면?
### 전제 조건 및 주의사항
- 마인크래프트 서버가 `spigot-{version}.jar` 를 실행하는 Spigot 서버여야 합니다.  
- 지도 기능을 활용하려고 한다면 어느정도 성능이 받쳐주는 서버여야 합니다. 서버 실행 시 JVM 옵션으로 `-Xmx4G -Xms4G` 정도는 줄 수 있는 서버면 좋습니다.
- 이 앱은 많은 사용자가 사용할 수 있도록 설계되지는 않았습니다. 사용자가 늘어날 수록 서버에 부담이 생길 수 있으므로, 적절히 서버 관리자 몇 명만 사용하시는 것을 추천합니다.

### 서버 준비
1. Spigot 서버의 `/plugins` 디렉터리에, Release 탭에 있는 `uncraft-1.0.jar` 를 추가합니다.
2. 마인크래프트 서버를 재시작합니다. 월드 로드가 끝나고 마지막에 `Responding http://0.0.0.0:25567` 과 같은 메시지가 두 번 출력되면 정상 실행된 것으로 간주할 수 있습니다.
3. 아무나 서버의 데이터에 접근하면 안되므로, 사용자를 인증할 수 있는 수단이 필요합니다. 서버의 콘솔에서 아래 명령을 입력합니다:
    ```
   uncraft generate with alias {alias} allows level {level}
   ```
   `{alias}` 는 이 인증 키에 붙힐 별칭, `{level}` 은 이 인증 키가 가질 권한의 레벨입니다.  
   별칭은 키를 구분하기 위해서 사용하며, 인증 키 삭제 시에 필요합니다.  
   권한 레벨에 따라 접근할 수 있는 리소스의 종류는, 현재로써는 딱히 구별되어있지 않아 인증 키가 있으면 권한 레벨에 관계 없이 현재 구현되어 있는 기능에는 모두 접근할 수 있습니다.  
   그럼에도 우선 권한 레벨은 1~4 사이로 설정할 것을 권장하며, 각각은 아래와 같은 의미를 지닙니다.
   - 1: ReadOnly - Low
   - 2: ReadOnly - High
   - 3: ReadWrite - Low
   - 4: ReadWrite - High
   
   해당 명령을 실행하면 `successfully generated with token` 메시지와 함께 랜덤 문자열이 출력됩니다. 이 문자열을 복사하여 잘 보관해주십시오.
4. 물리 서버 주소의 `25567` 및 `25568` 포트가 외부에서 접근 가능해야합니다.  
   일반적인 경우 접근이 막혀있지 않겠지만, 일부 환경에서 접근이 막혀있는 경우가 있을 수 있습니다.   
   이 경우는 서버 관리자 여러분께서 따로 설정하신 기억이 있으실 것이므로, 해당 포트를 직접 열어주세요.

### 실제 사용
1. Release 탭에 있는 `Uncraft-{platform}.zip` 을 다운받습니다.
2. 원하는 위치에 압축을 해제합니다. Mac 의 경우 `Uncraft.app` 디렉터리를 응용 프로그램 디렉터리로 복사해도 무관합니다.
3. 앱을 실행합니다. New Server 라는 이름의 설정 화면이 표시됩니다.
4. 서버 관련 값을 설정합니다.
   - 서버 이름  
     모니터 내에서 서버를 구별할 이름입니다. 나중에 변경 가능하므로 아무렇게나 입력해도 됩니다.
   - Minecraft 서버  
     마인크래프트 서버의 호스트 정보입니다. 왼쪽 입력창이 주소, 오른쪽이 포트입니다.  
     딱히 포트를 설정한 기억이 없다면 25565가 기본값이므로 그것을 사용합시다.
   - Uncraft 서버 포트  
     현재로서는 소스를 직접 변경하여 빌드한 경우가 아니라면 포트를 변경할 수 없게 되어있으므로 기본값을 사용하면 됩니다.  
   - Uncraft 서버 인증키  
     서버 준비 과정에서 `/uncraft generate` 커맨드를 사용해 만든 랜덤 문자열을 여기에 입력합니다.
5. 표시할 컨텐츠를 설정합니다.  
   컨텐츠는 그 뼈대를 설정하는 기능과 그것의 순서 및 사용 여부를 설정하는 영역으로 나뉩니다.  
   아래의 영역에서 더 상세히 서술하므로 관심이 있으시면 먼저 살펴보시고, 잘 모르겠다면 일단 기본값으로 두고 넘어갑시다.
6. 저장하려면 우하단의 버튼을 누릅니다. 잘못 입력된 값이 없다면 저장이 완료되고 메인 화면이 표시됩니다.
     
#### 표시 컨텐츠 설정
모니터링할 항목을 설정합니다.  
현재로서는 서버의 하드웨어 상태, 서버 내 특정 영역의 지도를 모니터링할 수 있습니다.
- 서버 상태 표시 설정
  - 표시 프로세스 수  
    프로세스 정보 요약에 표시할 총 프로세스 수입니다.
  - 재측정 딜레이  
    CPU Load 를 측정하기 위한 딜레이입니다. 최소 500 이상이어야 유효한 값이 측정됩니다.
  - 새로고침 주기  
    상태 자동 새로고침 주기입니다. 재측정 딜레이보다 일정 값 이상 커야합니다.
- 지도 설정  
  지도 설정은 여러 개를 추가할 수 있으며, 각각을 UI에서 실제로 표시할 지 별도로 지정할 수 있습니다.    
  여러 지역을 한 번에 확인하고 싶다면 각각의 위치 정보를 추가해보세요!
    - 지도 이름  
      설정을 구별하기 위한 값입니다. 마찬가지로 나중에 변경 가능하므로 아무렇게나 입력해도 됩니다.
    - 중심  
      표시될 지도의 중심 좌표입니다. 청크 단위이며, 왼쪽이 X, 오른쪽이 Z 입니다.  
      청크 좌표는 마인크래프트 게임 내에서 F3 을 통해 확인할 수 있습니다.
    - 범위  
      표시될 지도의 표시 범위입니다. 마찬가지로 청크단위이고, 왼쪽이 너비, 오른쪽이 높이 입니다.
    - 최대 렌더링 Y  
      지도 렌더링 시 지정한 Y 좌표 이상은 렌더링에서 제외할 수 있습니다.  
      지형의 단면을 확인하거나 지하의 지도를 확인하려고 할 때 유용합니다.  
      비워둘 수 있으며, 비워두면 해당 기능을 사용하지 않는 것으로 간주합니다.
    - 차원  
      가져올 지도의 차원을 설정합니다.
    - 방위(북쪽)  
      표시될 지도의 위쪽이 월드 내에서 어떤 축을 가리킬지를 정합니다.  
      기본값인 PositiveZ 의 경우 +Z 축이 지도의 북쪽과 일치하게 설정됩니다.
- 표시 컨텐츠 설정  
  컨텐츠의 뼈대 설정이 끝나면, 표시 컨텐츠 설정에 표시 가능한 컨텐츠들이 표시됩니다.  
  표시하지 않을 컨텐츠는 우측의 X 버튼을 눌러 제외할 수 있으며, 표시할 각 항목을 드래그하여 그 순서를 변경할 수 있습니다.

### 기타 인증키 관리
서버에서 한 번 발행한 인증키는 별칭을 사용하여 제거할 수 있습니다.  
서버 콘솔에서 아래와 같은 커맨드를 사용합니다:
```
uncraft revoke aliased {alias}
```

서버에서 발행한 인증키의 별칭 목록은 아래 명령을 통해 확인할 수 있습니다.  
```
uncraft list aliases
```
다만, 별칭의 실제 인증키는 표시되지 않으므로, 인증키를 잃어버렸다면 별칭과 위에서 서술한 커맨드를 통해 먼저 제거하고 다시 만들어야합니다.

## 주절주절
지도 렌더링이 생각보다 무겁고... 서버 리소스를 많이 잡아먹는 작업입니다.  
서버 하드웨어 상태 조회도 정확한 측정을 위해 최소 500ms 이상은 잡아먹는 작업이기도 하고...  
게다가 소켓으로 받는 데이터가 1초에 최대 10번이기 때문에 네트워크 사용량도 어마무시하게 많을 수 있습니다.  

위에서도 서술했지만 많은 사용자가 하나의 서버에 대해 사용할 수 있도록 설계되지 않았기 때문에... 한 서버에 한두사람만 사용하시는 것을 권장합니다.